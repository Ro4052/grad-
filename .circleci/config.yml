version: 2
jobs:
  build:

    working_directory: ~/library-grad-project-java

    docker:
    - image: circleci/openjdk:8-jdk-browsers

    steps:
    - checkout

    - restore_cache:
        key: library-grad-project-java-{{ checksum "pom.xml" }}

    - save_cache:
        paths:
        - ~/.m2
        key: library-grad-project-java-{{ checksum "pom.xml" }}

    - run:
        name: Setup Dependencies
        command: mvn package && cd src/main/client && npm install

    - run:
        name: Run Server Tests
        command: mvn surefire:test
    
    - run:
        name: Run Client Tests
        command: cd src/main/client && set CI=true && npm run test